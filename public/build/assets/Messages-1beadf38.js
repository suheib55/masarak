import{Q as S,r as n,H as V,I as E,o,b as j,w as D,d as t,e as b,v as w,c as r,g as k,F as C,t as c,f as x,J as K,K as m,L as M,n as g,i as L}from"./app-2594936b.js";import{_ as N}from"./MainLayout-a8c934ef.js";const $={class:"max-w-4xl mx-auto p-4"},F={class:"bg-white rounded-lg shadow overflow-hidden"},H={class:"p-4 border-b"},q={class:"flex h-[500px]"},z={class:"w-1/3 border-r overflow-y-auto"},I=["onClick"],J={class:"font-medium"},Q={class:"text-sm text-gray-500"},A={key:0,class:"bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"},G={class:"w-2/3 flex flex-col"},O={key:0,class:"p-3 border-b bg-gray-50"},P={class:"font-medium"},R={class:"text-xs mt-1 text-gray-500"},W={key:2,class:"p-3 border-t"},X={class:"flex gap-2"},Y=["disabled"],Z={key:3,class:"flex-1 flex items-center justify-center text-gray-500"},oe={__name:"Messages",setup(ee){const T=S().props.auth.user,d=n(""),h=n([]),p=n([]),l=n(null),i=n(""),u=n(null),_=n({}),U=async()=>{if(!d.value.trim()){h.value=[];return}try{const{data:s}=await m.get("/messages/search",{params:{q:d.value}});h.value=s}catch(s){console.error("Error searching users:",s)}},B=async s=>{l.value=s,_.value[s.id]=0;try{const{data:a}=await m.get(`/messages/${s.id}/fetch`);p.value=a.map(e=>({...e,isMine:e.sender_id===T.id})),M(y)}catch(a){console.error("Error fetching messages:",a)}},f=async()=>{if(!(!i.value.trim()||!l.value))try{const{data:s}=await m.post("/messages/send",{receiver_id:l.value.id,body:i.value});p.value.push({...s,isMine:!0}),i.value="",M(y)}catch(s){console.error("Error sending message:",s)}},y=()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)};return V(()=>{}),E(d,U),(s,a)=>(o(),j(N,null,{default:D(()=>[t("div",$,[a[2]||(a[2]=t("h1",{class:"text-2xl font-bold mb-4"},"Messages",-1)),t("div",F,[t("div",H,[b(t("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),type:"text",placeholder:"Search users...",class:"w-full p-2 border rounded"},null,512),[[w,d.value]])]),t("div",q,[t("div",z,[(o(!0),r(C,null,k(h.value,e=>{var v;return o(),r("div",{key:e.id,onClick:te=>B(e),class:g(["p-3 border-b hover:bg-gray-50 cursor-pointer flex justify-between items-center",{"bg-gray-100":((v=l.value)==null?void 0:v.id)===e.id}])},[t("div",null,[t("p",J,c(e.name),1),t("p",Q,c(e.email),1)]),_.value[e.id]?(o(),r("span",A,c(_.value[e.id]),1)):x("",!0)],10,I)}),128))]),t("div",G,[l.value?(o(),r("div",O,[t("p",P,"Chat with "+c(l.value.name),1)])):x("",!0),l.value?(o(),r("div",{key:1,ref_key:"chatContainer",ref:u,class:"flex-1 p-4 overflow-y-auto"},[(o(!0),r(C,null,k(p.value,(e,v)=>(o(),r("div",{key:v,class:g([e.isMine?"text-right":"text-left","mb-3"])},[t("div",{class:g(["inline-block px-4 py-2 rounded-lg max-w-[75%]",e.isMine?"bg-blue-100 text-blue-800":"bg-gray-200 text-gray-800"])},[L(c(e.body)+" ",1),t("div",R,c(new Date(e.created_at).toLocaleTimeString()),1)],2)],2))),128))],512)):x("",!0),l.value?(o(),r("div",W,[t("div",X,[b(t("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),onKeyup:K(f,["enter"]),type:"text",placeholder:"Type a message...",class:"flex-1 p-2 border rounded"},null,544),[[w,i.value]]),t("button",{onClick:f,class:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",disabled:!i.value.trim()}," Send ",8,Y)])])):(o(),r("div",Z," Select a user to start chatting "))])])])])]),_:1}))}};export{oe as default};
